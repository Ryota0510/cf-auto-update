<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #0b5394 0%, #1a73e8 100%);
      color: #333;
      padding: 0;
      overflow-x: hidden;
    }

    .header {
      background: rgba(255, 255, 255, 0.95);
      padding: 20px;
      text-align: center;
      border-bottom: 3px solid #0b5394;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .header h1 {
      font-size: 18px;
      color: #0b5394;
      margin-bottom: 5px;
    }

    .header p {
      font-size: 11px;
      color: #666;
    }

    /* ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
    .tab-nav {
      display: flex;
      background: white;
      border-bottom: 2px solid #e4e7eb;
    }

    .tab-btn {
      flex: 1;
      padding: 12px 8px;
      border: none;
      background: #f5f7fa;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      color: #666;
      transition: all 0.3s;
      border-bottom: 3px solid transparent;
    }

    .tab-btn:hover {
      background: #e4e7eb;
    }

    .tab-btn.active {
      background: white;
      color: #0b5394;
      border-bottom: 3px solid #0b5394;
    }

    .container {
      padding: 15px;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .section {
      background: white;
      border-radius: 12px;
      padding: 18px;
      margin-bottom: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .section-title {
      font-size: 15px;
      font-weight: bold;
      color: #0b5394;
      margin-bottom: 12px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    label {
      display: block;
      font-size: 12px;
      font-weight: 600;
      color: #555;
      margin-bottom: 5px;
    }

    input[type="text"],
    input[type="number"],
    input[type="date"],
    select,
    textarea {
      width: 100%;
      padding: 10px;
      border: 2px solid #e4e7eb;
      border-radius: 8px;
      font-size: 13px;
      transition: border-color 0.3s;
    }

    input:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: #0b5394;
    }

    textarea {
      resize: vertical;
      min-height: 60px;
      font-family: monospace;
    }

    .btn {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      margin-top: 10px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #0b5394 0%, #1a73e8 100%);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(11, 83, 148, 0.3);
    }

    .btn-secondary {
      background: #f5f7fa;
      color: #666;
    }

    .btn-secondary:hover {
      background: #e4e7eb;
    }

    .uncategorized-list {
      max-height: 400px;
      overflow-y: auto;
      margin-top: 15px;
    }

    .transaction-item {
      background: #f5f7fa;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 10px;
      border-left: 4px solid #e67e22;
      transition: all 0.3s;
    }

    .transaction-item:hover {
      background: #e4e7eb;
    }

    .inline-register {
      display: flex;
      gap: 8px;
      margin-top: 10px;
      align-items: center;
    }

    .inline-register select {
      flex: 1;
      padding: 8px;
      font-size: 12px;
    }

    .inline-register input {
      flex: 1;
      padding: 8px;
      font-size: 12px;
    }

    .inline-register button {
      padding: 8px 16px;
      background: #0b5394;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      white-space: nowrap;
    }

    .inline-register button:hover {
      background: #1a73e8;
    }

    .transaction-date {
      font-size: 11px;
      color: #999;
    }

    .transaction-desc {
      font-size: 13px;
      font-weight: 600;
      color: #333;
      margin: 5px 0;
    }

    .transaction-amount {
      font-size: 14px;
      font-weight: bold;
      color: #e67e22;
    }

    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
      background: #e67e22;
      color: white;
      margin-bottom: 10px;
    }

    .help-text {
      font-size: 11px;
      color: #999;
      margin-top: 5px;
    }

    .preview-box {
      background: #f5f7fa;
      border-radius: 8px;
      padding: 12px;
      margin-top: 10px;
      text-align: center;
    }

    .preview-count {
      font-size: 24px;
      font-weight: bold;
      color: #0b5394;
    }

    .template-list {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 15px;
    }

    .template-btn {
      padding: 10px;
      background: #f5f7fa;
      border: 2px solid #e4e7eb;
      border-radius: 8px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      transition: all 0.3s;
    }

    .template-btn:hover {
      background: #e4e7eb;
      border-color: #0b5394;
    }
  </style>
</head>
<body>
  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <div class="header">
    <h1>ğŸ’° CFè‡ªå‹•æ›´æ–° v5.0</h1>
    <p>Cash Flowç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </p>
  </div>

  <!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
  <div class="tab-nav">
    <button class="tab-btn active" onclick="switchTab('uncategorized')">æœªåˆ†é¡</button>
    <button class="tab-btn" onclick="switchTab('plan')">Planç™»éŒ²</button>
    <button class="tab-btn" onclick="switchTab('review')">æœˆæ¬¡ãƒ¬ãƒ“ãƒ¥ãƒ¼</button>
  </div>

  <div class="container">
    <!-- â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” -->
    <!-- ã‚¿ãƒ–1: æœªåˆ†é¡ãƒã‚¹ã‚¿ãƒ¼ -->
    <!-- â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” -->
    <div id="tab-uncategorized" class="tab-content active">
      <div class="section">
        <div class="section-title">ğŸ” æœªåˆ†é¡å–å¼•</div>
        <button class="btn btn-primary" onclick="loadUncategorized()">æœªåˆ†é¡ã‚’èª­ã¿è¾¼ã¿</button>
        <div id="uncategorized-count" class="badge" style="display: none; margin-top: 10px;">0ä»¶</div>
        <div id="uncategorized-list" class="uncategorized-list"></div>
      </div>

      <div class="section">
        <div class="section-title">ğŸ“ ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ«ãƒ¼ãƒ«ç™»éŒ²</div>
        <div class="form-group">
          <label>é¸æŠã—ãŸå–å¼•ã®æ‘˜è¦</label>
          <textarea id="selected-description" readonly placeholder="ä¸Šã®æœªåˆ†é¡å–å¼•ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„"></textarea>
        </div>

        <div class="form-group">
          <label>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆæ­£è¦è¡¨ç¾å¯ï¼‰</label>
          <input type="text" id="keyword-input" placeholder="ä¾‹: AMAZON|ã‚¢ãƒã‚¾ãƒ³">
          <div class="help-text">éƒ¨åˆ†ä¸€è‡´ã§æ¤œç´¢ã•ã‚Œã¾ã™</div>
        </div>

        <button class="btn btn-secondary" onclick="previewKeyword()">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</button>
        <div id="keyword-preview"></div>

        <div class="form-group">
          <label>ç§‘ç›®</label>
          <select id="keyword-category">
            <option value="å£²ä¸Š">å£²ä¸Š</option>
            <option value="åºƒå‘Šå®£ä¼è²»">åºƒå‘Šå®£ä¼è²»</option>
            <option value="å¤–æ³¨è²»">å¤–æ³¨è²»</option>
            <option value="æ¶ˆè€—å“è²»">æ¶ˆè€—å“è²»</option>
            <option value="é€šä¿¡è²»">é€šä¿¡è²»</option>
            <option value="æ”¯æ‰•æ‰‹æ•°æ–™">æ”¯æ‰•æ‰‹æ•°æ–™</option>
            <option value="é›‘è²»">é›‘è²»</option>
            <option value="å½¹å“¡å ±é…¬">å½¹å“¡å ±é…¬</option>
            <option value="å½¹å“¡å€Ÿå…¥é‡‘">å½¹å“¡å€Ÿå…¥é‡‘</option>
            <option value="ç«‹æ›¿é‡‘">ç«‹æ›¿é‡‘</option>
            <option value="å®¶è³ƒ">å®¶è³ƒ</option>
            <option value="äººä»¶è²»">äººä»¶è²»</option>
            <option value="ãã®ä»–åå…¥">ãã®ä»–åå…¥</option>
          </select>
        </div>

        <div class="form-group">
          <label>ã‚¿ã‚°ï¼ˆä»»æ„ï¼‰</label>
          <input type="text" id="keyword-tag" placeholder="ä¾‹: Googleåºƒå‘Š">
        </div>

        <button class="btn btn-primary" onclick="registerKeyword()">ãƒ«ãƒ¼ãƒ«ã‚’ç™»éŒ²</button>
      </div>
    </div>

    <!-- â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” -->
    <!-- ã‚¿ãƒ–2: Planç™»éŒ² -->
    <!-- â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” -->
    <div id="tab-plan" class="tab-content">
      <div class="section">
        <div class="section-title">ğŸ“… ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠ</div>
        <div class="template-list">
          <button class="template-btn" onclick="loadTemplate('rent')">å®¶è³ƒ</button>
          <button class="template-btn" onclick="loadTemplate('salary')">äººä»¶è²»</button>
          <button class="template-btn" onclick="loadTemplate('president')">ä»£è¡¨æ </button>
          <button class="template-btn" onclick="loadTemplate('upsider')">UPSIDERæ </button>
        </div>
      </div>

      <div class="section">
        <div class="section-title">ğŸ“ äºˆå®šå–å¼•ç™»éŒ²</div>

        <div class="form-group">
          <label>äºˆå®šæ—¥</label>
          <input type="date" id="plan-date">
        </div>

        <div class="form-group">
          <label>å£åº§</label>
          <select id="plan-account">
            <option value="ã¿ãšã»éŠ€è¡Œ">ã¿ãšã»éŠ€è¡Œ</option>
            <option value="SBIéŠ€è¡Œ">SBIéŠ€è¡Œ</option>
            <option value="æ¥½å¤©éŠ€è¡Œ">æ¥½å¤©éŠ€è¡Œ</option>
            <option value="UPSIDER">UPSIDER</option>
          </select>
        </div>

        <div class="form-group">
          <label>ç§‘ç›®</label>
          <select id="plan-category">
            <option value="å®¶è³ƒ">å®¶è³ƒ</option>
            <option value="äººä»¶è²»">äººä»¶è²»</option>
            <option value="åºƒå‘Šå®£ä¼è²»">åºƒå‘Šå®£ä¼è²»</option>
            <option value="å¤–æ³¨è²»">å¤–æ³¨è²»</option>
            <option value="å£²ä¸Š">å£²ä¸Š</option>
            <option value="ãã®ä»–åå…¥">ãã®ä»–åå…¥</option>
          </select>
        </div>

        <div class="form-group">
          <label>ã‚¿ã‚°</label>
          <input type="text" id="plan-tag" placeholder="ä¾‹: äº‹å‹™æ‰€å®¶è³ƒ">
        </div>

        <div class="form-group">
          <label>äºˆå®šé‡‘é¡ï¼ˆãƒã‚¤ãƒŠã‚¹ã§å‡ºé‡‘ï¼‰</label>
          <input type="number" id="plan-amount" placeholder="ä¾‹: -200000">
        </div>

        <div class="form-group">
          <label>ç¹°ã‚Šè¿”ã—ï¼ˆä»»æ„ï¼‰</label>
          <input type="text" id="plan-repeat" placeholder="ä¾‹: æ¯æœˆ25æ—¥">
        </div>

        <div class="form-group">
          <label>ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰</label>
          <input type="text" id="plan-memo" placeholder="ä¾‹: ä»£è¡¨æ ">
        </div>

        <button class="btn btn-primary" onclick="registerPlan()">Planç™»éŒ²</button>
      </div>
    </div>

    <!-- â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” -->
    <!-- ã‚¿ãƒ–3: æœˆæ¬¡ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
    <!-- â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” -->
    <div id="tab-review" class="tab-content">
      <div class="section">
        <div class="section-title">ğŸ“Š æœˆæ¬¡äºˆå®Ÿãƒ¬ãƒ“ãƒ¥ãƒ¼</div>
        <div class="form-group">
          <label>å¯¾è±¡æœˆ</label>
          <input type="month" id="review-month">
        </div>
        <button class="btn btn-primary" onclick="loadMonthlyReview()">ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º</button>
        <div id="review-result" style="margin-top: 15px;"></div>
      </div>

      <div class="section">
        <div class="section-title">ğŸ’¡ Phase 2ã§å®Ÿè£…äºˆå®š</div>
        <p style="font-size: 12px; color: #999;">
          ãƒ»å®Ÿç¸¾ vs äºˆå®šã®å·®ç•°åˆ†æ<br>
          ãƒ»å£åº§åˆ¥ã®æ®‹é«˜æ¨ç§»<br>
          ãƒ»ç§‘ç›®åˆ¥ã®é›†è¨ˆã‚°ãƒ©ãƒ•
        </p>
      </div>
    </div>
  </div>

  <script>
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    function switchTab(tabName) {
      // ã™ã¹ã¦ã®ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

      // é¸æŠã•ã‚ŒãŸã‚¿ãƒ–ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
      event.target.classList.add('active');
      document.getElementById('tab-' + tabName).classList.add('active');
    }

    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // ã‚¿ãƒ–1: æœªåˆ†é¡ãƒã‚¹ã‚¿ãƒ¼
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    let allCategories = [];

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ç§‘ç›®ä¸€è¦§ã‚’å–å¾—
    function loadCategories() {
      google.script.run
        .withSuccessHandler(function(result) {
          if (result.success) {
            allCategories = result.categories;
          }
        })
        .getAllCategories();
    }

    function loadUncategorized() {
      google.script.run
        .withSuccessHandler(function(result) {
          if (!result.success) {
            alert('ã‚¨ãƒ©ãƒ¼: ' + result.message);
            return;
          }

          const countBadge = document.getElementById('uncategorized-count');
          const listDiv = document.getElementById('uncategorized-list');

          if (result.count === 0) {
            listDiv.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">æœªåˆ†é¡å–å¼•ã¯ã‚ã‚Šã¾ã›ã‚“</p>';
            countBadge.style.display = 'none';
            return;
          }

          countBadge.textContent = result.count + 'ä»¶';
          countBadge.style.display = 'inline-block';

          // ç§‘ç›®ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç”Ÿæˆ
          const categoryOptions = allCategories.map(cat =>
            `<option value="${escapeHtml(cat)}">${escapeHtml(cat)}</option>`
          ).join('');

          let html = '';
          result.data.forEach((item, index) => {
            const amountColor = item.amount >= 0 ? '#2e7d32' : '#e67e22';
            const formattedDate = formatDate(item.date);

            html += `
              <div class="transaction-item" id="item-${index}">
                <div class="transaction-date">${formattedDate} | ${escapeHtml(item.account)}</div>
                <div class="transaction-desc">${escapeHtml(item.description)}</div>
                <div class="transaction-amount" style="color: ${amountColor};">Â¥${item.amount.toLocaleString()}</div>
                <div class="inline-register">
                  <select id="category-${index}">
                    <option value="">ç§‘ç›®ã‚’é¸æŠ</option>
                    ${categoryOptions}
                  </select>
                  <input type="text" id="tag-${index}" placeholder="ã‚¿ã‚°ï¼ˆä»»æ„ï¼‰">
                  <button onclick="registerInline(${index}, '${escapeHtml(item.description)}')">ç™»éŒ²</button>
                </div>
              </div>
            `;
          });

          listDiv.innerHTML = html;
        })
        .getUncategorizedTransactions();
    }

    function registerInline(index, description) {
      const category = document.getElementById('category-' + index).value;
      const tag = document.getElementById('tag-' + index).value;

      if (!category) {
        alert('ç§‘ç›®ã‚’é¸æŠã—ã¦ãã ã•ã„');
        return;
      }

      // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¨ã—ã¦æ‘˜è¦ã‚’ãã®ã¾ã¾ä½¿ç”¨
      const keyword = description;

      google.script.run
        .withSuccessHandler(function(result) {
          if (result.success) {
            alert('âœ… ãƒ«ãƒ¼ãƒ«ã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼');
            // ç™»éŒ²ã—ãŸé …ç›®ã‚’ãƒªã‚¹ãƒˆã‹ã‚‰å‰Šé™¤ï¼ˆè¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼‰
            const item = document.getElementById('item-' + index);
            if (item) {
              item.style.opacity = '0.3';
              item.style.pointerEvents = 'none';
            }
            // å°‘ã—å¾…ã£ã¦ã‹ã‚‰å†èª­ã¿è¾¼ã¿
            setTimeout(() => {
              loadUncategorized();
            }, 500);
          } else {
            alert('ã‚¨ãƒ©ãƒ¼: ' + result.message);
          }
        })
        .registerKeywordRule(keyword, category, tag);
    }

    function previewKeyword() {
      const keyword = document.getElementById('keyword-input').value;
      if (!keyword) {
        alert('ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
      }

      google.script.run
        .withSuccessHandler(function(result) {
          const previewDiv = document.getElementById('keyword-preview');
          previewDiv.innerHTML = `
            <div class="preview-box">
              <div class="preview-count">${result.count}ä»¶</div>
              <div style="font-size: 12px; color: #666; margin-top: 5px;">è©²å½“ã™ã‚‹å–å¼•</div>
            </div>
          `;
        })
        .previewKeywordMatch(keyword);
    }

    function registerKeyword() {
      const keyword = document.getElementById('keyword-input').value;
      const category = document.getElementById('keyword-category').value;
      const tag = document.getElementById('keyword-tag').value;

      if (!keyword || !category) {
        alert('ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¨ç§‘ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
      }

      google.script.run
        .withSuccessHandler(function(result) {
          if (result.success) {
            alert('âœ… ãƒ«ãƒ¼ãƒ«ã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼');
            // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢
            document.getElementById('keyword-input').value = '';
            document.getElementById('keyword-tag').value = '';
            document.getElementById('keyword-preview').innerHTML = '';
            // æœªåˆ†é¡ã‚’å†èª­ã¿è¾¼ã¿
            loadUncategorized();
          } else {
            alert('ã‚¨ãƒ©ãƒ¼: ' + result.message);
          }
        })
        .registerKeywordRule(keyword, category, tag);
    }

    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // ã‚¿ãƒ–2: Planç™»éŒ²
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    function loadTemplate(type) {
      const templates = {
        rent: {
          account: 'ã¿ãšã»éŠ€è¡Œ',
          category: 'å®¶è³ƒ',
          tag: 'äº‹å‹™æ‰€å®¶è³ƒ',
          amount: -200000,
          repeat: 'æ¯æœˆ25æ—¥'
        },
        salary: {
          account: 'ã¿ãšã»éŠ€è¡Œ',
          category: 'äººä»¶è²»',
          tag: 'çµ¦ä¸',
          amount: -300000,
          repeat: 'æ¯æœˆæœ«æ—¥'
        },
        president: {
          account: 'UPSIDER',
          category: 'åºƒå‘Šå®£ä¼è²»',
          tag: 'Googleåºƒå‘Š',
          amount: -150000,
          repeat: '',
          memo: 'ä»£è¡¨æ '
        },
        upsider: {
          account: 'UPSIDER',
          category: 'å¤–æ³¨è²»',
          tag: 'All AI',
          amount: -100000,
          repeat: '',
          memo: 'UPSIDERæ '
        }
      };

      const template = templates[type];
      if (!template) return;

      document.getElementById('plan-account').value = template.account;
      document.getElementById('plan-category').value = template.category;
      document.getElementById('plan-tag').value = template.tag;
      document.getElementById('plan-amount').value = template.amount;
      document.getElementById('plan-repeat').value = template.repeat || '';
      document.getElementById('plan-memo').value = template.memo || '';
    }

    function registerPlan() {
      const date = document.getElementById('plan-date').value;
      const account = document.getElementById('plan-account').value;
      const category = document.getElementById('plan-category').value;
      const tag = document.getElementById('plan-tag').value;
      const amount = document.getElementById('plan-amount').value;
      const repeat = document.getElementById('plan-repeat').value;
      const memo = document.getElementById('plan-memo').value;

      if (!date || !account || !category || !amount) {
        alert('äºˆå®šæ—¥ã€å£åº§ã€ç§‘ç›®ã€é‡‘é¡ã¯å¿…é ˆã§ã™');
        return;
      }

      const planData = {
        date: date,
        account: account,
        category: category,
        tag: tag,
        amount: parseFloat(amount),
        repeat: repeat,
        memo: memo
      };

      // GASå´ã§å®Ÿè£…äºˆå®š
      alert('âœ… Planã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼ï¼ˆPhase 2ã§å®Ÿè£…ï¼‰\n' + JSON.stringify(planData, null, 2));
    }

    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // ã‚¿ãƒ–3: æœˆæ¬¡ãƒ¬ãƒ“ãƒ¥ãƒ¼
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    function loadMonthlyReview() {
      const month = document.getElementById('review-month').value;
      if (!month) {
        alert('å¯¾è±¡æœˆã‚’é¸æŠã—ã¦ãã ã•ã„');
        return;
      }

      const resultDiv = document.getElementById('review-result');
      resultDiv.innerHTML = '<p style="text-align: center; color: #999;">Phase 2ã§å®Ÿè£…äºˆå®š</p>';
    }

    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    function escapeHtml(text) {
      if (!text) return '';
      return text
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }

    function formatDate(date) {
      if (!date) return '';
      const d = new Date(date);
      const year = d.getFullYear();
      const month = String(d.getMonth() + 1).padStart(2, '0');
      const day = String(d.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ä»Šæœˆã‚’ã‚»ãƒƒãƒˆã¨ç§‘ç›®ä¸€è¦§ã‚’å–å¾—
    document.addEventListener('DOMContentLoaded', function() {
      const today = new Date();
      const month = String(today.getMonth() + 1).padStart(2, '0');
      document.getElementById('review-month').value = `${today.getFullYear()}-${month}`;

      // ç§‘ç›®ä¸€è¦§ã‚’å–å¾—
      loadCategories();
    });
  </script>
</body>
</html>
